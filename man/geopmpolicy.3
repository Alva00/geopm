.\"
.\" Copyright (c) 2015, Intel Corporation
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\"
.\"     * Redistributions of source code must retain the above copyright
.\"       notice, this list of conditions and the following disclaimer.
.\"
.\"     * Redistributions in binary form must reproduce the above copyright
.\"       notice, this list of conditions and the following disclaimer in
.\"       the documentation and/or other materials provided with the
.\"       distribution.
.\"
.\"     * Neither the name of Intel Corporation nor the names of its
.\"       contributors may be used to endorse or promote products derived
.\"       from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
.\" "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
.\" LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
.\" A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
.\" OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
.\" SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
.\" LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY LOG OF THE USE
.\" OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.TH "GEOPMPOLICY" 3 "2015-10-12" "Intel Corporation" "GEOPM" \" -*- nroff -*-
.SH "NAME"
geopmpolicy \- geopm configuration creator and static mode enforcer
.SH "SYNOPSIS"
.SS CREATE CONFIGURATION:
.BR "geopmpolicy \-c \-f" " output " "\-m" " mode " "\-d" " key0:value0,key1:value1..."
.SS ENFORCE POLICY:
.BR "geopmpolicy \-e" " (" "\-f" " input | " "\-m" " mode " "\-d" " key0:value0,key1:value1...)"
.SS SAVE MSR:
.BR "geopmpolicy \-s" " [" "\-f" " output]"
.SS RESTORE MSR:
.BR "geopmpolicy \-r" " [" "\-f" " input]"
.SS CREATE MSR WHITELIST:
.BR "geopmpolicy \-w" " [" "\-f" " output]"
.SS PRINT VERSION OR HELP:
.BR "geopmpolicy \-\-version" "|" "\-\-help"
.SH "DESCRIPTION"
.sp
The
.B geopmpolicy
application can be used for five purposes: to create a
.BR geopm (3)
configuration file
.RB ( \-c ),
enforce a static power policy
.RB ( \-e ),
save to a file the state of
all MSR values that
.BR geopm (3)
may modify
.RB ( \-s ),
restore the MSR values from a saved state file
.RB ( \-r ),
or create a MSR whitelist for the Linux MSR driver
.RB ( \-w ).
The
geopmpolicy application also respects the standard
.BR "\-\-version" " and " "\-\-help"
options for printing the geopm version or a brief message about
usage.  The output from using the
.B \-c
option to create a configuration file can be used as the input for a
subsequent call to
.B geopmpolicy
with the
.B \-e
option, and this file can also be used to configure
.BR geopmctl (3)
and the
.BR geopm_ctl_c (3)
interfaces.  Through this use of
.B geopmpolicy
a resource manager can configure
.BR geopmctl (3)
through a plug-in without introducing a linking dependency between geopm and
the resource manager (as is required with the
.BR geopm_policy_c (3)
interface).  This enables a set of
.BR geopmctl (3)
features which can be described through a "mode" selection flag and a
"dictionary" flag for modifying the behavior of the mode by matching key
strings to value strings.
.B geopmpolicy
can also be used to enforce static power modes described in the
.B MODES
sections below.
.SH "OPTIONS"
.TP
.B \-\-help
.br
Print brief summary of the command line usage information, then exit.
.TP
.B \-\-version
.br
Print version of
.BR geopm (3)
to standard output, then exit.
.TP
.BR "\-c"
.br
Create a
.BR geopm (3)
configuration file,
.B "\-f"
must be specified when using this option which gives the path to the output
configuration file.
.TP
.BR "\-e"
.br
Enforce a static power mode, this mode can be specified with the
.BR "\-m" " and " "\-d"
options or the
.B "\-f"
option.
.TP
.BR "\-s"
.br
Create an in MSR save state file for all MSR values that
.BR geopm (3)
may modify.  The output file may be specified with the
.B "\-f"
option.
.TP
.B "\-r"
.br
Restore the MSR values that are recored in an existing MSR save state file.
The input file may be specified with the
.B "\-f"
option.
.TP
.BR "\-w"
.br
Create a Linux MSR driver whitelist file for the current platform, if
.B "\-f"
is not specified when using this option, the whitelist will be printed to
stdout.  This whitelist is the minimum set of MSR register privileges required
to enable all geopm functionality.  Enabling user access to these registers
may have security implications on a multi-user system.  Each line of the
whitelist output ends with a name describing the register as derived from the
Intel (R) Software Developer's Manual.  Please cross-reference Intel (R)
Software Developer's Manual to get details about the security implications of
the whitelist before enabling user access.
.TP
.BR "\-m" " mode"
.br
Power management mode, must be one of those described in the
.B MODES
section below.  The static modes do not require the geopm runtime to be
running concurrently with the primary computational application, where as
dynamic modes do have a runtime requirement on geopm.
.TP
.BR "\-d" " key0:value0,key1:value1"
.br
Specifies a dictionary of key value pairs which modify the behavior of a
mode.  The key and value options for each mode are described in the
.B MODES
sections below.
.\" NOTE: In the future these may be long form options rather than a dictionary to
.\" simplify issues around parsing commas, colons and spaces in the value field.
.TP
.BR "\-f" " file_path"
.br
When used with
.BR "\-c" " or " "\-s"
file_path is an output file.  When used with
.BR "\-e" " or " "\-r"
file_path is an input file.  This is a
.BR geopm (3)
configuration file when used with
.BR "\-c" " or " "\-e"
and an MSR save state file when used with
.BR "\-s" " or " "\-r" .
.sp
.SH "MODES"
.TP
.B tdp_balance_static
.br
Implements the GEOPM_MODE_TDP_BALANCE_STATIC mode described in the
.BR geopm_policy_c (3)
man page in the
.B STATIC MODES
section.  The only key required to be passed to
the
.B "\-d"
flag is the "tdp_percent" key which has a value that is the percent (0-100) of
the Thermal Design Power at which to run each processor under RAPL control.
All other keys are ignored.
.TP
.B freq_uniform_static
.br
Implements the GEOPM_MODE_FREQ_UNIFORM_STATIC mode described in the
.BR geopm_policy_c (3)
man page in the
.B STATIC MODES
section.  The only key required to be passed to
the
.B "\-d"
flag is the "cpu_mhz" key which has a value that is the CPU frequency in
units of MHz.  All other keys are ignored.
.TP
.B freq_hybrid_static
.br
Implements the GEOPM_MODE_FREQ_HYBRID_STATIC mode described in the
.BR geopm_policy_c (3)
man page in the
.B STATIC MODES
section.  There are three keys required to be
passed to the
.B "\-d"
flag for the freq_hybrid mode: "cpu_mhz" giving operating frequency for
restrained CPUs in units of MHz, "num_cpu_max_perf" giving the number of CPUs
running at maximum performance, and "affinity" which can have a value of
"compact" or "scatter" describing the distribution of the CPUs running at
maximum performance.  All other keys are ignored.
.TP
.B perf_balance_dynamic
Implements the GEOPM_MODE_PERF_BALANCE_DYNAMIC mode described in the
.BR geopm_policy_c (3)
man page in the
.B DYNAMIC MODES
section.  The only key required to be passed to
the
.B "\-d"
flag is the "power_budget" which is the power budget in units of Watts for all
compute nodes allocated to the job. All other keys are ignored.
.TP
.B freq_uniform_dynamic
Implements the GEOPM_MODE_FREQ_UNIFORM_DYNAMIC mode described in the
.BR geopm_policy_c (3)
man page in the
.B DYNAMIC MODES
section.  The only key required to be passed to
the
.B "\-d"
flag is the "power_budget" which is the power budget in units of Watts for all
compute nodes allocated to the job. All other keys are ignored.
.TP
.B freq_hybrid_dynamic
Implements the GEOPM_MODE_FREQ_HYBRID_DYNAMIC mode described in the
.BR geopm_policy_c (3)
man page in the
.B DYNAMIC MODES
section.  There are three keys required to be passed to the
.B "\-d"
flag for the freq_hybrid mode: "power_budget" which is the power budget in
units of Watts for all compute nodes allocated to the job , "num_cpu_max_perf"
giving the number of CPUs running at maximum performance, and "affinity" which
can have a value of "compact" or "scatter" describing the distribution of the
CPUs running at maximum performance.  All other keys are ignored.
.SH "EXAMPLES"
.TP
Create a configuration file which disables power management with RAPL:
.br
$ geopmpolicy -c -f geopm.conf -m tdp_balance_static -d tdp_percent:100
.TP
Create a configuration file for a fixed frequency of 1.5 GHz:
.br
$ geopmpolicy -c -f geopm.conf -m freq_uniform_static -d cpu_freq:1500
.TP
Create a configuration file for a hybrid frequency of 2.5 GHz where 4 cores are unconstrained and using scatter distribution:
.br
$ geopmpolicy -c -f geopm.conf -m freq_hybrid_static \\
.br
  -d cpu_freq:2500,num_cpu_max_perf:4,affinity:scatter
.TP
Create a configuration file for all processors to run at 75% of the Thermal Design Power:
.br
$ geopmpolicy -c -f geopm.conf -m tdp_balance_static -d tdp_percent:75
.TP
Create a configuration file for global energy optimization with a power budget of 1 MWatt:
.br
$ geopmpolicy -c -f geopm.conf -m perf_balance_dynamic -d power_budget:1000000
.TP
Enforce a static policy defined in a preexisting configuration file:
.br
$ geopmpolicy -e -f geopm.conf
.TP
Enforce a static policy where all processors to run at 75% of the Thermal Design Power:
.br
$ geopmpolicy -e -m tdp_balance_static -d tdp_percent:75
.TP
Save off the current state of the system MSRs:
.br
$ geopmpolicy -s -f geopm_restore.log
.TP
Restore the system MSRs to their previous state:
.br
$ geopmpolicy -r -f geopm_restore.log
.TP
Output a MSR whitelist file for use with the Linux MSR driver:
.br
$ geopmpolicy -w -f msr_whitelist.conf
.SH "COPYRIGHT"
Copyright (C) 2015 Intel Corporation. All rights reserved.
.SH "SEE ALSO"
.BR geopm (3),
.BR geopm_ctl_c (3),
.BR geopm_error (3),
.BR geopm_omp (3),
.BR geopm_policy_c (3),
.BR geopm_prof_c (3),
.BR geopm_version (3),
.BR geopmctl (3),
.BR geopmkey (3)
